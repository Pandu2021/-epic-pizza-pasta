## Deployment guide: cPanel (Node.js backend + SPA frontend)

This guide explains how to deploy the Epic Pizza & Pasta project onto a cPanel host using:
- Backend: NestJS app (Node.js) running with cPanel's Node.js/Passenger
- Frontend: React + Vite static build served from public_html (Apache)

Assumptions
- You have cPanel access and a domain like epicfoodorders.com
- cPanel user: epicfood (example) and Home Directory: /home/epicfood
- PostgreSQL database is provisioned and reachable from the host. If your host provides a managed DB, create one and note its connection string.

Environments and secrets
Create a Back-End/.env file with values based on Back-End/.env.example. At minimum set:
- NODE_ENV=production
- PORT (Passenger usually injects PORT, but default 4000 is fine)
- DATABASE_URL=postgresql://USER:PASSWORD@HOST:5432/DB?schema=public
- COOKIE_SECRET=... safe random string ...
- JWT_PRIVATE_KEY, JWT_PUBLIC_KEY (use scripts/generate-jwt-keys.js locally and paste)
- CORS_ORIGINS=https://epicfoodorders.com,https://www.epicfoodorders.com

Frontend .env (Front-End/.env):
- VITE_API_BASE_URL=https://epicfoodorders.com/api
- VITE_APP_NAME=Epic Pizza & Pasta

Step 1 — Prepare repository locally
1. Clone repo
2. Confirm production builds work locally
	- Backend: npm ci; npm run build
	- Frontend: npm ci; npm run build
3. Commit any final changes. Push to your Git provider if using cPanel Git deployment.

Step 2 — Backend on cPanel (Node.js application)
1. In cPanel, open “Setup Node.js App”
2. Create Application:
	- Node.js version: 18+ (match package.json engines)
	- Application mode: production
	- Application root: Back-End (folder path under your home)
	- Application URL: set to domain root (/) or a subdomain (e.g., api.epicfoodorders.com). Do NOT set "/api" because the app already serves endpoints under "/api/*".
	- Startup file: deploy/cpanel/app.js
3. Click “Create”.
4. Upload code:
	- Via Git (cPanel Git Version Control) OR manually upload the project and place backend files under the chosen Application root.
5. Environment variables:
	- In the Node.js App UI, add variables needed (optional) or ensure Back-End/.env exists on server.
6. Ensure devDependencies install so TypeScript and Prisma CLI are available:
	- In the Node.js App environment variables, add: `NPM_CONFIG_PRODUCTION=false`
	- Then click “Run NPM Install”. This will install dev deps and trigger the build via postinstall.
7. Database migrations:
	- In the same UI’s terminal (or cPanel Terminal), run from Back-End directory:
	  - npm run prisma:deploy
	- Optionally seed menu: npm run seed:menu
8. Restart the App.

Paths generated by this repo
- Passenger startup file: Back-End/deploy/cpanel/app.js
- Backend .htaccess template: Back-End/deploy/cpanel/.htaccess (for reference; cPanel creates its own). If needed, merge HTTPS and header rules.
- Trust proxy is enabled in src/main.ts for correct protocol/cookies.

Step 3 — Frontend on cPanel (static)
1. Build locally or in CI: cd Front-End; npm ci; npm run build
2. Upload dist/ contents to public_html of your domain. You can place them at root or a subfolder.
3. Ensure public_html/.htaccess contains SPA rules. This repo ships Front-End/public/.htaccess with proper rules; if you upload the entire Front-End/public, it will include this file. When building, copy the .htaccess into the uploaded folder if needed.
4. Confirm that direct deep links (e.g., /menu, /cart) work and index.html handles routing.

Routing between frontend and backend
- If backend is mounted at /api on the same domain, set VITE_API_BASE_URL to https://yourdomain.com/api
- Make sure CORS_ORIGINS includes the frontend origin.

SSL/HTTPS
- Use cPanel AutoSSL to issue/renew certificates.
- Both backend .htaccess and frontend .htaccess include HTTPS redirects.

Logs and debugging
- Node.js App page shows logs (stdout/stderr). You can also add Pino or file logging if needed.
- Health endpoint: GET https://yourdomain.com/api/health should return { status: 'ok', ... }

Common pitfalls
- Missing dist/main.js: Ensure NPM install ran and built. The backend’s postinstall script runs build.
- Prisma client version mismatch: Run npm run prisma:generate on server or ensure postinstall does it before build.
- Database firewall: Ensure the server can reach your PostgreSQL host.
- Cookies over HTTPS: With trust proxy enabled and secure cookies, ensure you’re testing via https.

Zero-downtime updates (simple)
- In Node.js App page: Stop app, “Run NPM Install” (pull new code first if using Git), then Restart.
- For static frontend: Upload the new dist/ files; Apache serves them immediately.

